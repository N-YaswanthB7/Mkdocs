<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://github.com/N-YaswanthB7/Mkdocs.git/Getting_Card_Details_From_EEPROM/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>üìÑ Getting Card Deatils From EEPROM - Design Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Design Documentation</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#getting-card-deatils-from-eeprom" class="nav-link">üìÑ Getting Card Deatils From EEPROM</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-overview" class="nav-link">üîç 1. Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2-scope" class="nav-link">üì¶ 2. Scope</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3-inputs-and-outputs" class="nav-link">üîÅ 3. Inputs and Outputs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#4-design-approach" class="nav-link">üõ†Ô∏è 4. Design Approach</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#5-step-wise-flow" class="nav-link">üîÑ 5. Step-wise Flow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#6-error-handling" class="nav-link">üö® 6. Error Handling</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#7-configuration-or-constants" class="nav-link">‚öôÔ∏è 7. Configuration or Constants</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="getting-card-deatils-from-eeprom">üìÑ <strong>Getting Card Deatils From EEPROM</strong></h1>
<p><strong>üè∑Ô∏è Title: Card Details Retrieval for Curiosity from EEPROM</strong><br />
<strong>üë§ Author: Narasapuram Yaswanth</strong><br />
<strong>üóìÔ∏è Date: 19-06-2025</strong></p>
<hr />
<h2 id="1-overview">üîç 1. Overview</h2>
<ul>
<li>This feature enables retrieval of the Card details from EEPROM for Curiosity card. The retrieved information will be used by the Galaxy application.</li>
</ul>
<hr />
<h2 id="2-scope">üì¶ 2. Scope</h2>
<p>This feature focuses on the retrieval of card data stored in the EEPROM of a Curiosity Card. The retrieved information is essential for Galaxy applications to link and access relevant metadata associated with the card.</p>
<hr />
<h2 id="3-inputs-and-outputs">üîÅ 3. Inputs and Outputs</h2>
<p><strong>üì• Inputs:</strong></p>
<ul>
<li>Input to <strong>get_card_details_from_eeprom()</strong> function is :<code>&amp;card_details_from_eeprom_return</code> which is a structure variable<ol>
<li>struct card_details_from_eeprom
    {
        unsigned short  card_id;
        char            card_name[55];
        char            part_code[65];
        char            internal_hardware_version[8];
        char            internal_software_version[8];
        char            external_hardware_version[8];
        char            external_software_version[8];
        unsigned int    card_uid;
        char            mac_compatible_48_bit_uid[20];
        unsigned char   m24aa256uid_device_address;
    };</li>
</ol>
</li>
</ul>
<p><strong>üì§ Outputs:</strong></p>
<ul>
<li>
<p>The function get_card_details_from_eeprom() returns a status code:</p>
<ul>
<li>
<p><code>SUCCESS</code> (typically defined as 0) if all EEPROM reads and data formatting operations succeed.</p>
</li>
<li>
<p><code>FAILURE</code> (typically defined as -1) if any error occurs during EEPROM probing, reading, or data formatting.</p>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="4-design-approach">üõ†Ô∏è 4. Design Approach</h2>
<p>The <code>start_up.c</code> file retrieves card-related information from EEPROM using the <code>get_card_details_from_eeprom()</code> function, which reads multiple fields from an EEPROM device connected via I2C_BUS_0, and stores the information in the <code>vm.args</code> file.</p>
<p><strong>Details:</strong></p>
<ul>
<li>It first probes the EEPROM device address using a shell command (<code>i2cdetect</code>) executed via <code>system()</code>. The exit code stored in <code>eeprom_probe_status</code>. The detected address is then stored in <code>command_error_code</code> using <code>WEXITSTATUS(eeprom_probe_status)</code>.</li>
<li>Several blocks of memory are read from the EEPROM using <code>read_multiple_bytes_from_m24aa256uid()</code>:<ul>
<li>Card ID (2 bytes)</li>
<li>Card Name (54 bytes)</li>
<li>Part Code (64 bytes)</li>
<li>Card Version (8 bytes)</li>
</ul>
</li>
<li>Versions are formatted into string representations of <code>major.minor</code> versions for internal/external hardware/software.</li>
<li>The function reads a 4-byte UID and a 6-byte 48-bit unique identification number (EUI-48) for MAC compatibility.</li>
<li>EUI-48 is validated to be non-zero to confirm a valid EEPROM.</li>
<li>The MAC address is formatted into a standard colon-separated hex string.</li>
<li>Any failure during I2C read or formatting causes the function to return <code>FAILURE</code>.</li>
</ul>
<hr />
<h2 id="5-step-wise-flow">üîÑ 5. Step-wise Flow</h2>
<p><strong>System Initialization Flow:</strong><br />
1. Triggered from system initialization.<br />
2. Executes <code>start_up.c</code>.<br />
3. Insdie <code>start_up.c</code>, it calls <code>get_card_details_from_eeprom()</code>.</p>
<p><strong>Inside <code>get_card_details_from_eeprom()</code> Function:</strong><br />
4. Execute shell command to probe EEPROM I2C device address.<br />
5. Validate device address.<br />
6. Then call to <code>read_multiple_bytes_from_m24aa256uid()</code> to:
    - Read card ID bytes from EEPROM.<br />
    - Read card name bytes from EEPROM.<br />
    - Read part code bytes from EEPROM.<br />
    - Read card version bytes from EEPROM.<br />
7. Format version numbers into strings.
8. Then call to <code>read_uid_from_m24aa256uid()</code> to: 
    - Read card UID bytes from EEPROM.<br />
9. Then call to <code>read_eui48_from_m24aa256uid()</code> to: 
    - Read 48-bit EUI-48 bytes from EEPROM.<br />
10. Validate EUI-48 is non-zero.<br />
11. Format MAC-compatible 48-bit UID string.<br />
12. Return <code>SUCCESS</code> if all operations succeed; otherwise <code>FAILURE</code>.</p>
<hr />
<h2 id="6-error-handling">üö® 6. Error Handling</h2>
<ul>
<li>If the EEPROM probe command fails or returns an invalid address, it prints an error message to the console and return <code>FAILURE</code>.</li>
<li>If any of the EEPROM reads fail, the function returns <code>FAILURE</code>.</li>
<li>If formatting the version strings or MAC string fails (e.g., <code>sprintf</code> returns an error), it prints an error message to the console and return <code>FAILURE</code>.</li>
<li>If the EUI-48 read value is all zeros, indicating invalid data, prints an error message to the console and return <code>FAILURE</code>.</li>
</ul>
<p>These errors ensure the system does not operate on invalid or incomplete card data.</p>
<hr />
<h2 id="7-configuration-or-constants">‚öôÔ∏è 7. Configuration or Constants</h2>
<p><strong>EEPROM memory address constants:</strong></p>
<ul>
<li><code>card_id_start_memory_address = 0x0040</code></li>
<li><code>card_name_start_memory_address = 0x0042</code></li>
<li><code>card_version_start_memory_address = 0x0078</code></li>
<li><code>part_code_start_memory_address = 0x0080</code></li>
</ul>
<p><strong>Number of bytes to read for each field:</strong></p>
<ul>
<li>Card ID: 2 bytes</li>
<li>Card Name: 54 bytes</li>
<li>Card Version: 8 bytes</li>
<li>Part Code: 64 bytes</li>
<li>card_uid: 4 bytes</li>
<li>EEPROM 48-bit EUI (EUI-48): 6 bytes</li>
</ul>
<p><strong>Device address probing range:</strong></p>
<ul>
<li><code>0x50</code> to <code>0x57</code></li>
</ul>
<p><strong>Use of macros:</strong></p>
<ul>
<li><code>#define SUCCESS 0</code> and <code>#define FAILURE -1</code> for status returns</li>
<li><code>#define M24AA256UID_UID_MEMORY_ADDRESS 0x7FFC</code></li>
<li><code>#define M24AA256UID_EUI48_MEMORY_ADDRESS 0x7F7A</code></li>
<li><code>IS_SPRINTF_RETURNED_ERROR()</code> for validating <code>sprintf</code> results</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
